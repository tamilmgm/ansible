---
- hosts: all
  become: yes
  tasks:

    - name: Kill all running Google Chrome processes
      shell: pkill -f chrome || true
      ignore_errors: yes

    - name: Ensure Google's APT key is added
      apt_key:
        url: https://dl.google.com/linux/linux_signing_key.pub
        state: present

    - name: Add Google Chrome repository
      apt_repository:
        repo: "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main"
        state: present
        filename: 'google-chrome'

    - name: Update APT cache
      apt:
        update_cache: yes

    - name: Install or upgrade Google Chrome
      apt:
        name: google-chrome-stable
        state: latest

    - name: Relaunch Google Chrome
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
      shell: nohup google-chrome >/dev/null 2>&1 &
      async: 0
      poll: 0
